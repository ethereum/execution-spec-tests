# Transaction Tests <!-- markdownlint-disable MD051 (MD051=link-fragments "Link fragments should be valid") -->

The Transaction Test fixture format tests are included in the fixtures subdirectory `transaction_tests`.

These are produced by the `TransactionTest` test spec.

## Description

The transaction test fixture format is used to test client's transaction RLP parsing without executing the transaction on the EVM.

It does so by defining a transaction binary RLP representation, and whether the transaction should be accepted or rejected by the client in each fork.

A single JSON fixture file is composed of a JSON object where each key-value pair is a different [`Fixture`](#fixture) test object, with the key string representing the test name.

The JSON file path plus the test name are used as the unique test identifier.

The transaction test fixture format could contain multiple test vectors per test object, each represented by an element in the mapping of lists of the `result` field.

However tests generated by the `execution-spec-tests` repository do **not** use this feature, as every single test object contains only a single test vector.

## Consumption

For each [`Fixture`](#fixture) test object in the JSON fixture file, perform the following steps:

1. Obtain the [`txbytes`](#-txbytes-bytes) serialized bytes of the transaction to be parsed.
2. For each [`Fork`](./common_types.md#fork) key of [`result`](#-result-mappingforkfixtureresult) in the test:

    1. Assume the fork schedule according to the current [`Fork`](./common_types.md#fork) key.
    2. Using the [`txbytes`](#-txbytes-bytes), attempt to decode the transaction.
    3. If the transaction could not be decoded:
        - If the [`hash`](#-hash-hash-none) field is present, fail the test.
        - Compare the exception thrown with the expected exception contained in the [`exception`](#-exception-transactionexception) field, and fail the test if they do not match.
        - Proceed to the next fork.
    4. If the transaction could be decoded:
        - Compare the calculated hash with the expected hash contained in the [`hash`](#-hash-hash-none) field, and fail the test if they do not match.
        - Compare the calculated intrinsic gas with the expected intrinsic gas contained in the [`intrinsicGas`](#-intrinsicgas-zeropaddedhexnumber) field, and fail the test if they do not match.
        - Compare the calculated sender with the expected sender contained in the [`sender`](#-sender-address) field, and fail the test if they do not match.

## Structures

### `Fixture`

#### - `txbytes`: [`Bytes`](./common_types.md#bytes)

Serialized bytes of the transaction under test.

#### - `result`: [`Mapping`](./common_types.md#mapping)`[`[`Fork`](./common_types.md#fork)`,`[`FixtureResult`](#fixtureresult) `]`

Mapping of results for verification per fork, where each key-value represents a single possible outcome of the transaction parsed in the given fork.

### `FixtureResult`

#### - `hash`: [`Hash`](./common_types.md#hash) `| None`

Calculated hash of the transaction (Field is missing if the transaction is expected to fail).

#### - `intrinsicGas`: [`ZeroPaddedHexNumber`](./common_types.md#zeropaddedhexnumber)

Total intrinsic gas cost of the transaction (Field is missing if the transaction is expected to fail).

#### - `sender`: [`Address`](./common_types.md#address)

Sender address of the transaction (Field is missing if the transaction is expected to fail).

#### - `exception`: [`TransactionException`](./exceptions.md#transactionexception)

Exception that is expected to be thrown by the transaction parsing (Field is missing if the transaction is expected to succeed).
