<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
        
        <style>

    html body {
        font-family: '', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #2196F3;
        --border-width:  0 ;
    }

</style>


<link rel="stylesheet" href="http://localhost:1313/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=">





<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
 






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.148.0">
        


        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        <link rel="stylesheet" href="http://localhost:1313/css/callouts.css">
    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#"></a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2></h2>
        <h5></h5>
        

    </div>

    <div align="start" class="content"><h1 id="filling-tests-at-a-prompt">Filling Tests at a Prompt</h1>
<p>The execution-spec-tests test framework uses the <a href="https://docs.pytest.org/en/latest/">pytest framework</a> for test case collection and execution. The <code>fill</code> command is essentially an alias for <code>pytest</code>, which uses several <a href="../library/pytest_plugins/main.md">custom pytest plugins</a> to run transition tools against test cases and generate JSON fixtures.</p>
<p>!!! note &ldquo;Options specific to execution-spec-tests&rdquo;
The command-line options specific to filling tests can be listed via:</p>
<pre><code>```console
uv run fill --help
```

See [Custom `fill` Command-Line Options](#custom-fill-command-line-options) for all options.
</code></pre>
<h2 id="collection---test-exploration">Collection - Test Exploration</h2>
<p>The test cases implemented in the <code>./tests</code> sub-directory can be listed in the console using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill --collect-only
</span></span></code></pre></div><p>and can be filtered (by test path, function and parameter substring):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill --collect-only -k warm_coinbase
</span></span></code></pre></div><p>Docstrings are additionally displayed when ran verbosely:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill --collect-only -k warm_coinbase -vv
</span></span></code></pre></div><h2 id="execution">Execution</h2>
<p>By default, test cases are filled for all forks already deployed to mainnet, but not for forks still under active development, i.e., as of time of writing, Q2 2023:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill
</span></span></code></pre></div><p>will generate fixtures for test cases from Frontier to Shanghai.</p>
<p>To generate all the test fixtures defined in the <code>./tests/shanghai</code> sub-directory and write them to the <code>./fixtures-shanghai</code> directory, run <code>fill</code> in the top-level directory as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill ./tests/shanghai --output=&#34;fixtures-shanghai&#34;
</span></span></code></pre></div><p>!!! note &ldquo;Test case verification&rdquo;
Note, that the (limited set of) test <code>post</code> conditions are tested against the output of the <code>evm t8n</code> command during test generation.</p>
<p>To generate all the test fixtures in the <code>tests/shanghai/eip3651_warm_coinbase/test_warm_coinbase.py</code> module, for example, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill tests/shanghai/eip3651_warm_coinbase/test_warm_coinbase.py
</span></span></code></pre></div><p>To generate specific test fixtures from a specific test function or even test function and parameter set, obtain the corresponding test ID using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill --collect-only -q -k test_warm_coinbase
</span></span></code></pre></div><p>This filters the tests by <code>test_warm_coinbase</code>. Then find the relevant test ID in the console output and provide it to fill, for example, for a test function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill tests/shanghai/eip3651_warm_coinbase/test_warm_coinbase.py::test_warm_coinbase_gas_usage
</span></span></code></pre></div><p>or, for a test function and specific parameter combination:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill tests/shanghai/eip3651_warm_coinbase/test_warm_coinbase.py::test_warm_coinbase_gas_usage[fork_Paris-DELEGATECALL]
</span></span></code></pre></div><h2 id="execution-for-development-forks">Execution for Development Forks</h2>
<p>!!! note &quot;&quot;
By default, test cases are not filled for upcoming Ethereum forks so that they can be readily filled using the <code>evm</code> tool from the latest <code>geth</code> release.</p>
<pre><code>In order to fill test cases for an upcoming fork, ensure that the `evm` tool used supports that fork and features under test and use the `--until` or `--fork` flag.

For example, as of Q2 2023, the current fork under active development is `Cancun`:
```console
uv run fill --until Cancun
```

See: [Filling Tests for Features under Development](./filling_tests_dev_fork.md).
</code></pre>
<h2 id="debugging-the-t8n-command">Debugging the <code>t8n</code> Command</h2>
<p>The <code>--evm-dump-dir</code> flag can be used to dump the inputs and outputs of every call made to the <code>t8n</code> command for debugging purposes, see <a href="./debugging_t8n_tools.md">Debugging Transition Tools</a>.</p>
<h2 id="other-useful-pytest-command-line-options">Other Useful Pytest Command-Line Options</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill -vv            # More verbose output
</span></span><span style="display:flex;"><span>uv run fill -x             # Exit instantly on first error or failed test case
</span></span><span style="display:flex;"><span>uv run fill --pdb -nauto   # Drop into the debugger upon error in a test case
</span></span><span style="display:flex;"><span>uv run fill -s             # Print stdout from tests to the console during execution
</span></span></code></pre></div><h2 id="custom-fill-command-line-options">Custom <code>fill</code> Command-Line Options</h2>
<p>To see all the options available to fill, including pytest and pytest plugin options, use <code>--pytest-help</code>.</p>
<p>To list the options that only specific to fill, use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>uv run fill --help
</span></span></code></pre></div><p>For a complete, up-to-date list of all command-line options, see the <a href="filling_tests_command_line_options.md">Fill Command-Line Options</a> page, which is automatically generated from the current <code>uv run fill --help</code> output.</p>
</div>

</main>

        <footer>
            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

