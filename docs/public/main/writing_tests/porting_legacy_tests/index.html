
<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porting Legacy Tests - EEST Docs</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
         
        .top-nav {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 1800px;   
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            background-color: rgba(255,255,255,0.1);
        }
        
         
        .main-container {
            display: flex;
            max-width: 1800px;   
            margin: 0 auto;
            padding: 2rem 3rem;   
            gap: 2rem;
        }
        
         
        .sidebar {
            flex: 0 0 250px;
            position: sticky;
            top: 80px;  
            height: calc(100vh - 100px);
            overflow-y: auto;
            background-color: #f8f8f8;
            transition: transform 0.3s ease;
        }
        
         
        .content {
            flex: 1;
            min-width: 0;
            max-width: 100%;
            padding: 0 2rem;   
            transition: margin-left 0.3s ease, width 0.3s ease;
        }
        
         
        .content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
        }
        
         
        .content article,
        .content > div {
            max-width: 100%;
        }
        
        .content h1 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .content h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #34495e;
        }
        
        .content h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #34495e;
        }
        
        .content pre {
            background-color: #f4f4f4;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .content code {
            background-color: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        .content pre code {
            background-color: transparent;
            padding: 0;
        }
        
         
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 60px;
                transform: translateX(-100%);
                z-index: 999;
            }
            
            .content {
                margin-left: 0;
                width: 100%;
                padding: 0 1rem;   
            }
            
            .main-container {
                flex-direction: column;
                padding: 1rem;   
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
         
        @media (min-width: 1600px) {
            .sidebar {
                flex: 0 0 300px;
            }
            
            .main-container {
                max-width: 90%;   
            }
        }
        
         
        @media (min-width: 1920px) {
            .content {
                padding: 2rem 4rem;
            }
        }
    </style>

    
    <link rel="stylesheet" href="http://localhost:1313/css/callouts.css">
<link rel="stylesheet" href="http://localhost:1313/css/sidebar.css">

</head>
<body>
       

        
        <nav class="top-nav">
            <div class="nav-container">
                <a href="/" class="nav-brand">EEST Docs</a>
                <ul class="nav-menu">
                    
                    
                        
                            <li>
                                <a href="/main/main/" 
                                   >
                                    Execution Spec Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/getting_started/main/" 
                                   >
                                    Getting Started
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/writing_tests/main/" 
                                   >
                                    Writing Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/filling_tests/main/" 
                                   >
                                    Filling Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/running_tests/main/" 
                                   >
                                    Running Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/dev_docs/main/" 
                                   >
                                    Developer Doc
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/changelog/" 
                                   >
                                    Changelog
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </nav>
    
    
    <div class="main-container">
        <aside class="sidebar">
            
  
<nav style="background:#f5f5f5;padding:1.5rem;border-radius:8px;position:sticky;top:2rem;max-height:calc(100vh - 4rem);overflow-y:auto;">
  

  
  
  
    
  

  
  
  
    
  

  
  <h3 style="margin-top:0;padding-bottom:.5rem;border-bottom:2px solid #ddd;">Writing Tests</h3>

  
  
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  

  
  
  

  <ul style="list-style:none;padding:0;margin:1rem 0;">
    
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/main/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          Writing Tests
          <span style="font-size:.8em;opacity:.7;display:block;">Entry Point</span>
        </a>
      </li>
    

    
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/adding_a_new_test/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Adding a New Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/types_of_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Types of Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/writing_a_new_test/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Writing a New Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/test_markers/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Test Markers
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/exception_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Exception Tests
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/fork_methods/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Using and Extending Fork Methods
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/reference_specification/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Referencing an EIP Spec Version
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/eip_checklist/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ EIP Checklist Generation
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/post_mortems/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          üìÑ Post-Mortems
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/porting_legacy_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    background-color:#007bff;color:#fff;font-weight:bold;
                  ">
          üìÑ Porting Legacy Tests
        </a>
      </li>
    
  </ul>

  
  
  
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
            
            
          
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
            
            
          
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  

  
    <hr style="margin:1.5rem 0;border:none;border-top:1px solid #ddd;">
    <h4 style="margin-top:1rem;color:#666;font-size:.9em;">Subsections</h4>
    <ul style="list-style:none;padding:0;">
      
        <li style="margin:.5rem 0;">
          <a href="/main/writing_tests/checklist_templates/"
             style="display:block;padding:.5rem;color:#666;text-decoration:none;transition:all .2s;">
            üìÅ Checklist templates
          </a>
        </li>
      
        <li style="margin:.5rem 0;">
          <a href="/main/writing_tests/tutorials/"
             style="display:block;padding:.5rem;color:#666;text-decoration:none;transition:all .2s;">
            üìÅ Tutorials
          </a>
        </li>
      
    </ul>
  

  
  
    <hr style="margin:1.5rem 0;border:none;border-top:1px solid #ddd;">
    <h4 style="margin-top:1rem;color:#666;font-size:.9em;">Other Sections</h4>
    <ul style="list-style:none;padding:0;font-size:.9em;">
      
        <li style="margin:.25rem 0;">
          <a href="/main/main/" style="color:#666;text-decoration:none;">
            ‚Üí Execution Spec Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/getting_started/main/" style="color:#666;text-decoration:none;">
            ‚Üí Getting Started
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/writing_tests/main/" style="color:#666;text-decoration:none;">
            ‚Üí Writing Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/filling_tests/main/" style="color:#666;text-decoration:none;">
            ‚Üí Filling Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/running_tests/main/" style="color:#666;text-decoration:none;">
            ‚Üí Running Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/dev_docs/main/" style="color:#666;text-decoration:none;">
            ‚Üí Developer Doc
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/changelog/" style="color:#666;text-decoration:none;">
            ‚Üí Changelog
          </a>
        </li>
      
    </ul>
  
</nav>


        </aside>
        
        <main class="content">
            
  <div>
    <h2>Porting Legacy Tests</h2>
    <h5></h5>
    
  </div>
  <div align="start" class="content"><h2 id="background">Background</h2>
<p>EEST is the successor to <a href="https://github.com/ethereum/tests" target="_blank" rel="noopener">ethereum/tests</a> (aka &ldquo;original tests&rdquo;), a repository that defined EVM test cases from the <a href="https://ethereum.org/en/history/#frontier" target="_blank" rel="noopener">Frontier</a> phase up to and including <a href="https://ethereum.org/en/history/#paris" target="_blank" rel="noopener">The Merge</a>. These test cases are specified as YAML (and occasionally JSON) files in the <a href="https://github.com/ethereum/tests/tree/develop/src" target="_blank" rel="noopener"><code>./src/</code></a> sub-directory. JSON test fixtures, which are fully-populated tests that can be executed against clients, are generated using <a href="https://github.com/ethereum/retesteth" target="_blank" rel="noopener">ethereum/retesteth</a>. These JSON artifacts are regenerated when needed and added to the repository, typically in the <a href="https://github.com/ethereum/execution-spec-tests/tree/main/tests/static/state_tests" target="_blank" rel="noopener"><code>tests/static/state_tests</code></a> sub-directory.</p>
<p>From <a href="https://ethereum.org/en/history/#shapella" target="_blank" rel="noopener">Shanghai</a> onward, new test cases ‚Äî especially for new features introduced in hard forks‚Äîare defined in Python within EEST. While the existing test cases remain important for client testing, porting ethereum/tests to EEST will help maintain and generate tests for newer forks. This also ensures feature parity, as client teams will only need to obtain test fixture releases from one source.</p>
<p>While automating the conversion of the remaining YAML (or JSON) test cases to Python is possible, manually porting individual test cases offers several benefits:</p>
<ul>
<li>Reducing the number of test cases by combining multiple YAML (or JSON) cases into a single Python test function using parametrization.</li>
<li>Potentially improving coverage by parametrizing the Python version.</li>
<li>Producing higher quality code and documentation, which are typically clearer than an automated conversion.</li>
<li>Ensuring better organization of tests within the <code>./tests</code> folder of execution-spec-tests by fork and EIP.</li>
</ul>
<h2 id="porting-an-original-test">Porting an original test</h2>
<ol>
<li>
<p>Select one or more test cases from <code>./tests/static/state_tests/</code> to port and create an issue in this repository AND comment on <a href="https://github.com/ethereum/execution-spec-tests/issues/972" target="_blank" rel="noopener">this tracker issue.</a></p>
</li>
<li>
<p><a href="../writing_tests/main.md">Add a new test</a> in the appropriate fork folder, following the guidelines for <a href="../writing_tests/types_of_tests.md#deciding-on-a-test-type">choosing a test type.</a></p>
</li>
<li>
<p>Submit a PR with the ported tests:</p>
<ol>
<li>
<p>Add the list of ported files using python marker to the head of your python test.</p>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#a6e22e">@pytest.mark.ported_from</span>(
</span></span><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://github.com/ethereum/tests/blob/v13.3/src/GeneralStateTestsFiller/stCreateTest/CREATE_ContractSuicideDuringInit_ThenStoreThenReturnFiller.json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://github.com/ethereum/tests/blob/v13.3/src/GeneralStateTestsFiller/stCreateTest/CREATE_ContractSuicideDuringInit_WithValueFiller.json&#34;</span>,
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>pr<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;https://github.com/ethereum/execution-spec-tests/pull/1871&#34;</span>],
</span></span><span style="display:flex;"><span><span style="color:#75715e"># coverage_missed_reason=&#34;Converting solidity code result in following opcode not being used:&#34;,</span>
</span></span></code></pre></div><p>Replace test names with your chosen tests and PR number.</p>
<p>Uncomment coverage_missed_reason when all the missed coverage lines are approved, usually some opcodes end up not used after translating test logic from lllc, yul.</p>
<p>But sometimes missed coverage line could hint that you forgot to account important test logic.</p>
<p>If no coverage is missed, you are good!</p>
</li>
<li>
<p>Remove the ported files from .tests/static/state_tests in your PR</p>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>See also: üìÑ <a href="../getting_started/repository_overview.md">Getting started with EEST.</a></p></blockquote>
<h2 id="filling-tests">Filling tests</h2>
<p>EEST uses pytest to run tests against <a href="https://github.com/ethereum/execution-specs" target="_blank" rel="noopener">EELS (an EVM implementation for testing)</a>. This process is known as &ldquo;filling&rdquo; and verifies the assertions in your tests. You can use the fill CLI for this. For example, see how to fill the <code>PUSH</code> opcode.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>uv run fill tests/frontier/opcodes/test_push.py
</span></span></code></pre></div><p>See also: üìÑ <a href="../filling_tests/filling_tests_command_line.md">Documentation for the <code>fill</code> command.</a></p>
<blockquote>
<p>If the tests can&rsquo;t currently be filled, please explain the issue (feel free to also <a href="https://github.com/ethereum/execution-spec-tests/discussions/new?category=general" target="_blank" rel="noopener">open a Discussion</a>).</p></blockquote>
<h2 id="debugging-tests">Debugging tests</h2>
<p>By default, EVM logs are stored in the <code>logs</code> folder at the repository root. You can check the <code>output</code> folder to review transaction results. If needed, review a previous PR that ported tests (e.g., <a href="https://github.com/ethereum/execution-spec-tests/pull/975" target="_blank" rel="noopener">the PR porting the <code>PUSH</code> opcode</a>, and <a href="https://github.com/ethereum/execution-spec-tests/pulls?q=is%3Apr&#43;label%3Aport" target="_blank" rel="noopener">other port PRs</a>).</p>
<h2 id="test-coverage">Test coverage</h2>
<p>It&rsquo;s crucial that ported tests maintain coverage parity with <em>original tests</em>. This ensures that no critical functions are left untested and prevents the introduction of bugs. A CI workflow automatically checks for coverage.</p>
<p>If coverage action fails (See: üìÑ <a href="https://github.com/ethereum/execution-spec-tests/actions/runs/13037332959/job/36370897481" target="_blank" rel="noopener">An example of a failing test coverage</a>), it&rsquo;s recommended to run the coverage action locally (see: üìÑ <a href="../dev/test_actions_locally.md">How to run GitHub actions locally</a>), which should generate a <code>evmtest_coverage</code> directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>‚ùØ tree evmtest_coverage  -L 2
</span></span><span style="display:flex;"><span>evmtest_coverage
</span></span><span style="display:flex;"><span>‚îî‚îÄ‚îÄ coverage
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ BASE
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ BASE_TESTS
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ coverage_BASE.lcov
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ coverage_PATCH.lcov
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ DIFF
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ difflog.txt
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ PATCH
</span></span><span style="display:flex;"><span>    ‚îî‚îÄ‚îÄ PATCH_TESTS
</span></span></code></pre></div><p>Here <code>BASE</code>is <em>original tests</em>, <code>PATCH</code> is the ported test, and <code>DIFF</code> is the coverage difference on EVMONE. Open <code>evmtest_coverage/coverage/DIFF/index.html</code> in browser:</p>
<p><img src="../img/annotated-coverage.jpg" alt="Annotated coverage"></p>
<table>
  <thead>
      <tr>
          <th>Label</th>
          <th style="text-align: center">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>LBC</code></td>
          <td style="text-align: center"><strong>Lost base coverage:</strong> Code that was tested before, but is untested now.</td>
      </tr>
      <tr>
          <td><code>UBC</code></td>
          <td style="text-align: center"><strong>Uncovered baseline code:</strong> Code that was untested before and untested now.</td>
      </tr>
      <tr>
          <td><code>GBC</code></td>
          <td style="text-align: center"><strong>Gained baseline coverage:</strong> Code that was untested before, but is tested now.</td>
      </tr>
      <tr>
          <td><code>CBC</code></td>
          <td style="text-align: center"><strong>Covered baseline code:</strong> Code that was tested before and is tested now.</td>
      </tr>
  </tbody>
</table>
<p>Follow the hyperlinks for lost base coverage (<code>LBC</code>) to address coverage gaps. Here is an example coverage loss:</p>
<p><img src="../img/original-coverage-loss.png" alt="Missing original coverage"></p>
<blockquote>
<p>Lost line coverage from a coverage report. In this case, caused by a missing invocation of <code>CALLDATALOAD</code>.</p></blockquote>


<div class="callout callout-info">
  <div class="callout-title">Expected coverage loss</div>
  <div class="callout-content">
    <p>EEST uses <a href="https://docs.pytest.org/en/stable/" target="_blank" rel="noopener">pytest</a>, a popular Python testing framework, to help orchestrate testing Ethereum specifications, while <em>original tests</em> relied on large, static contracts and the EVM to handle much of the execution. This difference can lead to coverage gaps. EEST favors dynamic contract creation for each test vector, while <em>original tests</em> preferred a single static contract with multiple test vectors determined by transaction input data.</p>
<p>It&rsquo;s important to note that coverage helps identify missing test paths. If you believe the coverage loss is due to differences in &ldquo;setup&rdquo; code between frameworks and doesn&rsquo;t impact the feature you&rsquo;re testing, explain this in your PR. A team member can help with the review.</p>
<p>For example, review the <a href="https://github.com/ethereum/execution-spec-tests/pull/975#issuecomment-2528792289" target="_blank" rel="noopener">discussion in this PR</a> to see an example of why and how coverage loss can occur.</p>

  </div>
</div>
<h2 id="resolving-coverage-gaps-from-yul-compilation">Resolving Coverage Gaps from Yul Compilation</h2>
<p>When porting tests from ethereum/tests, you may encounter coverage gaps that are false positives. This commonly occurs because:</p>
<ul>
<li><strong>Original tests</strong> often used Yul to define smart contracts, and solc compilation introduces additional opcodes that aren&rsquo;t specifically under test</li>
<li><strong>EEST ports</strong> use the explicit EEST Opcode mini-language, which is more precise in opcode definition</li>
</ul>
<p>If coverage analysis shows missing opcodes that were only present due to Yul compilation artifacts (not the actual feature being tested), this can be resolved during PR review by adding the <code>coverage_missed_reason</code> parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.ported_from</span>(
</span></span><span style="display:flex;"><span>    [<span style="color:#e6db74">&#34;path/to/original_test.json&#34;</span>],
</span></span><span style="display:flex;"><span>    coverage_missed_reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Missing opcodes are Yul compilation artifacts, not part of tested feature&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div>

<div class="callout callout-info">
  <div class="callout-title">Add coverage_missed_reason only after PR review</div>
  <div class="callout-content">
    Only add <code>coverage_missed_reason</code> after PR review determines the coverage gap is acceptable, never preemptively. This helps maintain test coverage integrity while accounting for legitimate differences between Yul-based and EEST opcode-based implementations.
  </div>
</div>
</div>

        </main>
    </div>
</body>
</html>