
<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Markers - EEST Docs</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
         
        .top-nav {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 1800px;   
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            background-color: rgba(255,255,255,0.1);
        }
        
         
        .main-container {
            display: flex;
            max-width: 1800px;   
            margin: 0 auto;
            padding: 2rem 3rem;   
            gap: 2rem;
        }
        
         
        .sidebar {
            flex: 0 0 250px;
            position: sticky;
            top: 80px;  
            height: calc(100vh - 100px);
            overflow-y: auto;
            background-color: #f8f8f8;
            transition: transform 0.3s ease;
        }
        
         
        .content {
            flex: 1;
            min-width: 0;
            max-width: 100%;
            padding: 0 2rem;   
            transition: margin-left 0.3s ease, width 0.3s ease;
        }
        
         
        .content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
        }
        
         
        .content article,
        .content > div {
            max-width: 100%;
        }
        
        .content h1 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .content h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #34495e;
        }
        
        .content h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #34495e;
        }
        
        .content pre {
            background-color: #f4f4f4;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .content code {
            background-color: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        .content pre code {
            background-color: transparent;
            padding: 0;
        }
        
         
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 60px;
                transform: translateX(-100%);
                z-index: 999;
            }
            
            .content {
                margin-left: 0;
                width: 100%;
                padding: 0 1rem;   
            }
            
            .main-container {
                flex-direction: column;
                padding: 1rem;   
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
         
        @media (min-width: 1600px) {
            .sidebar {
                flex: 0 0 300px;
            }
            
            .main-container {
                max-width: 90%;   
            }
        }
        
         
        @media (min-width: 1920px) {
            .content {
                padding: 2rem 4rem;
            }
        }
    </style>

    
    <link rel="stylesheet" href="http://localhost:1313/css/callouts.css">
<link rel="stylesheet" href="http://localhost:1313/css/sidebar.css">

</head>
<body>
       

        
        <nav class="top-nav">
            <div class="nav-container">
                <a href="/" class="nav-brand">EEST Docs</a>
                <ul class="nav-menu">
                    
                    
                        
                            <li>
                                <a href="/main/main/" 
                                   >
                                    Execution Spec Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/getting_started/main/" 
                                   >
                                    Getting Started
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/writing_tests/main/" 
                                   >
                                    Writing Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/filling_tests/main/" 
                                   >
                                    Filling Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/running_tests/main/" 
                                   >
                                    Running Tests
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/dev_docs/main/" 
                                   >
                                    Developer Doc
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/main/changelog/" 
                                   >
                                    Changelog
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </nav>
    
    
    <div class="main-container">
        <aside class="sidebar">
            
  
<nav style="background:#f5f5f5;padding:1.5rem;border-radius:8px;position:sticky;top:2rem;max-height:calc(100vh - 4rem);overflow-y:auto;">
  

  
  
  
    
  

  
  
  
    
  

  
  <h3 style="margin-top:0;padding-bottom:.5rem;border-bottom:2px solid #ddd;">Writing Tests</h3>

  
  
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
        
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  
    
      
      
      
    
  

  
  
  

  <ul style="list-style:none;padding:0;margin:1rem 0;">
    
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/main/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          Writing Tests
          <span style="font-size:.8em;opacity:.7;display:block;">Entry Point</span>
        </a>
      </li>
    

    
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/adding_a_new_test/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Adding a New Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/types_of_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Types of Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/writing_a_new_test/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Writing a New Test
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/test_markers/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    background-color:#007bff;color:#fff;font-weight:bold;
                  ">
          📄 Test Markers
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/exception_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Exception Tests
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/fork_methods/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Using and Extending Fork Methods
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/reference_specification/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Referencing an EIP Spec Version
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/eip_checklist/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 EIP Checklist Generation
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/post_mortems/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Post-Mortems
        </a>
      </li>
    
      <li style="margin:.5rem 0;">
        <a href="/main/writing_tests/porting_legacy_tests/"
           style="display:block;padding:.75rem;border-radius:4px;text-decoration:none;transition:all .2s;
                  
                    color:#333;background-color:#fff;border:1px solid #e0e0e0;
                  ">
          📄 Porting Legacy Tests
        </a>
      </li>
    
  </ul>

  
  
  
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
            
            
          
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
            
            
          
        
      
    
  
    
      
      
        
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
        
        
          
          
        
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  

  
    <hr style="margin:1.5rem 0;border:none;border-top:1px solid #ddd;">
    <h4 style="margin-top:1rem;color:#666;font-size:.9em;">Subsections</h4>
    <ul style="list-style:none;padding:0;">
      
        <li style="margin:.5rem 0;">
          <a href="/main/writing_tests/checklist_templates/"
             style="display:block;padding:.5rem;color:#666;text-decoration:none;transition:all .2s;">
            📁 Checklist templates
          </a>
        </li>
      
        <li style="margin:.5rem 0;">
          <a href="/main/writing_tests/tutorials/"
             style="display:block;padding:.5rem;color:#666;text-decoration:none;transition:all .2s;">
            📁 Tutorials
          </a>
        </li>
      
    </ul>
  

  
  
    <hr style="margin:1.5rem 0;border:none;border-top:1px solid #ddd;">
    <h4 style="margin-top:1rem;color:#666;font-size:.9em;">Other Sections</h4>
    <ul style="list-style:none;padding:0;font-size:.9em;">
      
        <li style="margin:.25rem 0;">
          <a href="/main/main/" style="color:#666;text-decoration:none;">
            → Execution Spec Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/getting_started/main/" style="color:#666;text-decoration:none;">
            → Getting Started
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/writing_tests/main/" style="color:#666;text-decoration:none;">
            → Writing Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/filling_tests/main/" style="color:#666;text-decoration:none;">
            → Filling Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/running_tests/main/" style="color:#666;text-decoration:none;">
            → Running Tests
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/dev_docs/main/" style="color:#666;text-decoration:none;">
            → Developer Doc
          </a>
        </li>
      
        <li style="margin:.25rem 0;">
          <a href="/main/changelog/" style="color:#666;text-decoration:none;">
            → Changelog
          </a>
        </li>
      
    </ul>
  
</nav>


        </aside>
        
        <main class="content">
            
  <div>
    <h2>Test Markers</h2>
    <h5></h5>
    
  </div>
  <div align="start" class="content"><p>Test markers are used to categorize tests and to run specific subsets of tests. They are defined in the test files using the <code>pytest.mark</code> decorator.</p>
<p>The examples below use <code>StateTestFiller</code> tests, but the same markers can also be applied to <code>BlockchainTestFiller</code> tests.</p>
<h2 id="fork-markers">Fork Markers</h2>
<p>These markers are used to specify the forks for which a test is valid.</p>
<h3 id="pytestmarkvalid_fromfork_name"><code>@pytest.mark.valid_from(&quot;FORK_NAME&quot;)</code></h3>
<p>Bases: <code>ValidityMarker</code></p>
<p>Marker used to specify the fork from which the test is valid. The test will not be filled for forks before the specified fork.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;London&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_only_valid_after_london</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will only be filled for the London fork and after, e.g. London, Paris, Shanghai, Cancun, etc.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkvalid_untilfork_name"><code>@pytest.mark.valid_until(&quot;FORK_NAME&quot;)</code></h3>
<p>Bases: <code>ValidityMarker</code></p>
<p>Marker to specify the fork until which the test is valid. The test will not be filled for forks after the specified fork.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_until</span>(<span style="color:#e6db74">&#34;London&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_only_valid_until_london</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will only be filled for the London fork and before, e.g. London, Berlin, Istanbul, etc.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkvalid_atfork_name_1-fork_name_2-"><code>@pytest.mark.valid_at(&quot;FORK_NAME_1&quot;, &quot;FORK_NAME_2&quot;, ...)</code></h3>
<p>Bases: <code>ValidityMarker</code></p>
<p>Marker to specify each fork individually for which the test is valid.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_at</span>(<span style="color:#e6db74">&#34;London&#34;</span>, <span style="color:#e6db74">&#34;Cancun&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_only_valid_at_london_and_cancun</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will only be filled for the London and Cancun forks.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkvalid_at_transition_tofork_name"><code>@pytest.mark.valid_at_transition_to(&quot;FORK_NAME&quot;)</code></h3>
<p>Bases: <code>ValidityMarker</code></p>
<p>Marker to specify that a test is only meant to be filled at the transition to the specified fork.</p>
<p>The test usually starts at the fork prior to the specified fork at genesis and at block 5 (for pre-merge forks) or at timestamp 15,000 (for post-merge forks) the fork transition occurs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, BlockchainTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_at_transition_to</span>(<span style="color:#e6db74">&#34;London&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_that_happens_during_the_fork_transition_to_london</span>(
</span></span><span style="display:flex;"><span>    blockchain_test: BlockchainTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will only be filled for the fork that transitions to London at block number 5, BerlinToLondonAt5, and no other forks.</p>
<p>To see or add a new transition fork, see the ethereum_test_forks.forks.transition module.</p>
<p>Note that the test uses a BlockchainTestFiller fixture instead of a StateTestFiller, as the transition forks are used to test changes throughout the blockchain progression, and not just the state change of a single transaction.</p>
<p>This marker also accepts the following keyword arguments:</p>
<ul>
<li>subsequent_transitions: Force the test to also fill for subsequent fork transitions.</li>
<li>until: Implies subsequent_transitions and puts a limit on which transition fork will the test filling will be limited to.</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_at_transition_to</span>(<span style="color:#e6db74">&#34;Cancun&#34;</span>, subsequent_transitions<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>produces tests on <code>ShanghaiToCancunAtTime15k</code> and <code>CancunToPragueAtTime15k</code>, and any transition fork after that.
And:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_at_transition_to</span>(<span style="color:#e6db74">&#34;Cancun&#34;</span>, subsequent_transitions<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, until<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Prague&#34;</span>)
</span></span></code></pre></div><p>produces tests on ShanghaiToCancunAtTime15k and CancunToPragueAtTime15k, but no forks after Prague.</p>
<!-- ------------------------------------------------------------------------ -->
<h2 id="fork-covariant-markers">Fork Covariant Markers</h2>
<p>These markers are used in conjunction with the fork validity markers to automatically parameterize tests with values that are valid for the fork being tested.</p>
<h3 id="pytestmarkwith_all_tx_types"><code>@pytest.mark.with_all_tx_types</code></h3>
<p>This marker is used to automatically parameterize a test with all transaction types that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_tx_types</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Berlin&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_tx_types</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller, 
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    tx_type: int
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parameterized for parameter <code>tx_type</code> with values <code>[0, 1]</code> for fork Berlin, but with values <code>[0, 1, 2]</code> for fork London (because of EIP-1559).</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_contract_creating_tx_types"><code>@pytest.mark.with_all_contract_creating_tx_types</code></h3>
<p>This marker is used to automatically parameterize a test with all contract creating transaction types that are valid for the fork being tested.</p>
<p>This marker only differs from <code>pytest.mark.with_all_tx_types</code> in that it does not include transaction type 3 (Blob Transaction type) on fork Cancun and after.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_precompiles"><code>@pytest.mark.with_all_precompiles</code></h3>
<p>This marker is used to automatically parameterize a test with all precompiles that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_precompiles</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Shanghai&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_precompiles</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller, 
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    precompile: int,
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parameterized for parameter <code>precompile</code> with values <code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code> for fork Shanghai, but with values <code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code> for fork Cancun which introduced the <a href="https://eips.ethereum.org/EIPS/eip-4844#point-evaluation-precompile" target="_blank" rel="noopener">point evaluation precompile</a> defined in EIP-4844.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_evm_code_types"><code>@pytest.mark.with_all_evm_code_types</code></h3>
<p>This marker is used to automatically parameterize a test with all EVM code types that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_evm_code_types</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Frontier&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_evm_code_types</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,     
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parameterized for parameter <code>evm_code_type</code> only with value <code>[EVMCodeType.LEGACY]</code> starting on fork Frontier, and eventually it will be parametrized with with values <code>[EVMCodeType.LEGACY, EVMCodeType.EOF_V1]</code> on the EOF activation fork.</p>
<p>In all calls to <code>pre.deploy_contract</code>, if the code parameter is <code>Bytecode</code> type, and <code>evm_code_type==EVMCodeType.EOF_V1</code>, the bytecode will be automatically wrapped in an EOF V1 container.</p>
<p>Code wrapping might fail in the following circumstances:</p>
<ul>
<li>The code contains invalid EOF V1 opcodes.</li>
<li>The code does not end with a valid EOF V1 terminating opcode (such as <code>Op.STOP</code> or <code>Op.REVERT</code> or <code>Op.RETURN</code>).</li>
</ul>
<p>In the case where the code wrapping fails, <code>evm_code_type</code> can be added as a parameter to the test and the bytecode can be dynamically modified to be compatible with the EOF V1 container.</p>
<p>One thing to note is that <code>evm_code_type</code> is not necessary to be added as a parameter to the test because the <code>pre: Alloc</code> fixture automatically consumes this fixture, and therefore it only needs to be added to the test signature if the test&rsquo;s logic needs it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_vm <span style="color:#f92672">import</span> EVMCodeType
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_vm <span style="color:#f92672">import</span> Opcodes <span style="color:#66d9ef">as</span> Op
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_evm_code_types</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Frontier&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_evm_code_types</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    evm_code_type: EVMCodeType
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    code <span style="color:#f92672">=</span> Op<span style="color:#f92672">.</span>SSTORE(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> evm_code_type <span style="color:#f92672">==</span> EVMCodeType<span style="color:#f92672">.</span>EOF_V1:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Modify the bytecode to be compatible with EOF V1 container</span>
</span></span><span style="display:flex;"><span>        code <span style="color:#f92672">+=</span> Op<span style="color:#f92672">.</span>STOP
</span></span><span style="display:flex;"><span>    pre<span style="color:#f92672">.</span>deploy_contract(code)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_call_opcodes"><code>@pytest.mark.with_all_call_opcodes</code></h3>
<p>This marker is used to automatically parameterize a test with all EVM call opcodes that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_vm <span style="color:#f92672">import</span> Opcodes <span style="color:#66d9ef">as</span> Op
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_call_opcodes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Frontier&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_call_opcodes</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    call_opcode: Op
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parametrized for parameter <code>call_opcode</code> with values <code>[Op.CALL, Op.CALLCODE]</code> starting on fork Frontier, <code>[Op.CALL, Op.CALLCODE, Op.DELEGATECALL]</code> on fork Homestead, <code>[Op.CALL, Op.CALLCODE, Op.DELEGATECALL, Op.STATICCALL]</code> on fork Byzantium, and eventually it will be parametrized with with values <code>[Op.CALL, Op.CALLCODE, Op.DELEGATECALL, Op.STATICCALL, Op.EXTCALL, Op.EXTSTATICCALL, Op.EXTDELEGATECALL]</code> on the EOF activation fork.</p>
<p>Parameter <code>evm_code_type</code> will also be parametrized with the correct EVM code type for the opcode under test.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_create_opcodes"><code>@pytest.mark.with_all_create_opcodes</code></h3>
<p>This marker is used to automatically parameterize a test with all EVM create opcodes that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_vm <span style="color:#f92672">import</span> Opcodes <span style="color:#66d9ef">as</span> Op
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_create_opcodes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Frontier&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_create_opcodes</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    create_opcode: Op
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parametrized for parameter <code>create_opcode</code> with values <code>[Op.CREATE]</code> starting on fork Frontier, <code>[Op.CREATE, Op.CREATE2]</code> starting on fork Constantinople, and eventually it will be parametrized with with values <code>[Op.CREATE, Op.CREATE2, Op.EOFCREATE]</code> on the EOF activation fork.</p>
<p>Parameter <code>evm_code_type</code> will also be parametrized with the correct EVM code type for the opcode under test.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="pytestmarkwith_all_system_contracts"><code>@pytest.mark.with_all_system_contracts</code></h3>
<p>This marker is used to automatically parameterize a test with all system contracts that are valid for the fork being tested.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_base_types <span style="color:#f92672">import</span> Address
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_system_contracts</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Cancun&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_system_contracts</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller,
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    system_contract: Address,
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parameterized for parameter <code>system_contract</code> with value <code>[0x000F3DF6D732807EF1319FB7B8BB8522D0BEAC02]</code> for fork Cancun.</p>
<br>
<hr>
<!-- ------------------------------------------------------------------------ -->
<h3 id="covariant-marker-keyword-arguments">Covariant Marker Keyword Arguments</h3>
<p>All fork covariant markers accept the following keyword arguments:</p>
<h4 id="selector"><code>selector</code></h4>
<p>A lambda function that can be used to filter the fork covariant values that are valid for this specific test.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_tx_types</span>(selector<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> tx_type: tx_type <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;London&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_tx_types</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller, 
</span></span><span style="display:flex;"><span>    pre: Alloc,
</span></span><span style="display:flex;"><span>    tx_type: int
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>Ideally, the lambda function should be used to explicitly filter out values that are not compatible with the test (exclusive filter), rather than explicitly selecting values (inclusive filter), as the parametrized values might change with future forks.</p>
<h4 id="marks"><code>marks</code></h4>
<p>A marker, list of markers, or a lambda function that can be used to add additional markers to the test.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.with_all_tx_types</span>(
</span></span><span style="display:flex;"><span>    marks<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> tx_type: pytest<span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>skip(<span style="color:#e6db74">&#34;incompatible&#34;</span>) <span style="color:#66d9ef">if</span> tx_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;London&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something_with_all_tx_types_but_skip_type_1</span>(state_test_only, tx_type):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> tx_type <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>In this example, the test will be skipped if <code>tx_type</code> is equal to 1 by returning a <code>pytest.mark.skip</code> marker, and return <code>None</code> otherwise.</p>
<h2 id="pytestmarkparametrize_by_fork"><code>@pytest.mark.parametrize_by_fork</code></h2>
<p>A test can be dynamically parametrized based on the fork using the <code>parametrize_by_fork</code> marker.</p>
<p>This marker takes two positional arguments:</p>
<ul>
<li><code>argnames</code>: A list of parameter names that will be parametrized using the custom function.</li>
<li><code>fn</code>: A function that takes the fork as parameter and returns a list of values that will be used to parametrize the test at that specific fork.</li>
</ul>
<p>And one keyword argument:</p>
<ul>
<li><code>marks</code> (optional): A marker, list of markers, or a lambda function that can be used to add additional markers to the generated tests.</li>
</ul>
<p>The marked test function will be parametrized by the values returned by the <code>fn</code> function for each fork.</p>
<p>If the parameters that are being parametrized is only a single parameter, the return value of <code>fn</code> should be a list of values for that parameter.</p>
<p>If the parameters that are being parametrized are multiple, the return value of <code>fn</code> should be a list of tuples/lists, where each tuple contains the values for each parameter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">covariant_function</span>(fork):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]] <span style="color:#66d9ef">if</span> fork<span style="color:#f92672">.</span>name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Paris&#34;</span> <span style="color:#66d9ef">else</span> [[<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>], [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>], [<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.parametrize_by_fork</span>(<span style="color:#e6db74">&#34;test_parameter,test_parameter_2&#34;</span>, covariant_function)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_from</span>(<span style="color:#e6db74">&#34;Paris&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.valid_until</span>(<span style="color:#e6db74">&#34;Shanghai&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_case</span>(state_test_only, test_parameter, test_parameter_2):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be parametrized with the values <code>[1, 2]</code> and <code>[3, 4]</code> for the Paris fork, with values <code>1</code> and <code>3</code> being assigned to <code>test_parameter</code> and <code>2</code> and <code>4</code> being assigned to <code>test_parameter_2</code>. For the Shanghai fork, the test will be parametrized with the values <code>[4, 5]</code>, <code>[5, 6]</code>, and <code>[6, 7]</code>. Therefore, more test cases will be generated for the Shanghai fork.</p>
<p>If the parameters that are being parametrized is only a single parameter, the return value of <code>fn</code> should be a list of values for that parameter.</p>
<p>If the parameters that are being parametrized are multiple, the return value of <code>fn</code> should be a list of tuples/lists, where each tuple contains the values for each parameter.</p>
<p>The function can also return a list of <code>pytest.param</code> objects, which allows for additional markers and test IDs to be added to the test.</p>
<h2 id="fillexecute-markers">Fill/Execute Markers</h2>
<p>These markers are used to apply different markers to a test depending on whether it is being filled or executed.</p>
<h3 id="pytestmarkfill"><code>@pytest.mark.fill</code></h3>
<p>This marker is used to apply markers to a test when it is being filled.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.fill</span>(pytest<span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>skip(reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Only for execution&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller, 
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be skipped when it is being filled.</p>
<h3 id="pytestmarkexecute"><code>@pytest.mark.execute</code></h3>
<p>This marker is used to apply markers to a test when it is being executed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.execute</span>(pytest<span style="color:#f92672">.</span>mark<span style="color:#f92672">.</span>xfail(reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Depends on block context&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something</span>(
</span></span><span style="display:flex;"><span>    state_test: StateTestFiller, 
</span></span><span style="display:flex;"><span>    pre: Alloc
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p>In this example, the test will be marked as expected to fail when it is being executed, which is particularly useful so that the test is still executed but does not fail the test run.</p>
<h2 id="other-markers">Other Markers</h2>
<h3 id="pytestmarkslow"><code>@pytest.mark.slow</code></h3>
<p>This marker is used to mark tests that are slow to run. These tests are not run during <a href="http://localhost:1313/main/getting_started/code_standards_details/"><code>tox</code> checks</a>, and are only run when a release is being prepared.</p>
<h3 id="pytestmarkpre_alloc_modify"><code>@pytest.mark.pre_alloc_modify</code></h3>
<p>This marker is used to mark tests that modify the pre-alloc in a way that would be impractical to reproduce in a real-world scenario.</p>
<p>Examples of this include:</p>
<ul>
<li>Modifying the pre-alloc to have a balance of 2^256 - 1.</li>
<li>Address collisions that would require hash collisions.</li>
</ul>
<h3 id="pytestmarkskip"><code>@pytest.mark.skip()</code></h3>
<p>This marker can be used to skip a test.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.skip</span>(reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Not implemented&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something</span>(state_test: StateTestFiller, pre: Alloc):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><h3 id="pytestmarkxfail"><code>@pytest.mark.xfail()</code></h3>
<p>This marker can be used to mark a test as expected to fail.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ethereum_test_tools <span style="color:#f92672">import</span> Alloc, StateTestFiller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@pytest.mark.xfail</span>(reason<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;EVM binary doesn&#39;t support this opcode&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_something</span>(state_test: StateTestFiller, pre: Alloc):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div></div>

        </main>
    </div>
</body>
</html>